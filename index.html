<!DOCTYPE html>
{% autoescape true %}

<html>
<head>
<meta charset="utf-8">
<title>GMaps.js &mdash; Tests</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script type="text/javascript" src="https://rawgit.com/HPNeo/gmaps/master/gmaps.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<!--<link rel="stylesheet" href="http://twitter.github.com/bootstrap/1.3.0/bootstrap.min.css" />-->
<link rel="stylesheet" type="text/css" href="https://linux.ime.usp.br/~scaroni/gmaps/example.css" />


<script type="text/javascript">
    var map;
    var myLocations = [];
    var possiblePlaces;
    var origem;
    var dest;
    
    function UpdateDropdownLists()
    {
      var origDropdown = "<select name=selectOrigem onchange='getOrigem(this);' required>";
      var destDropdown = "<select name=selectDest onchange='getDest(this);' required>";
      for (var op in possiblePlaces)
      {
        if (possiblePlaces[op] != dest)
        {
          if(possiblePlaces[op] == origem)
          {
            origDropdown = origDropdown + "<option selected='selected'>"+possiblePlaces[op]+"</option>";
          }
          else
          {
            origDropdown = origDropdown + "<option>"+possiblePlaces[op]+"</option>";
          }          
        }
        if (possiblePlaces[op] != origem)
        {
          if(possiblePlaces[op] == dest)
          {
            destDropdown = destDropdown + "<option selected='selected'>"+possiblePlaces[op]+"</option>";
          }
          else
          {
            destDropdown = destDropdown + "<option>"+possiblePlaces[op]+"</option>";
          }
        }
      }
      origDropdown = origDropdown +  "</select>";
      destDropdown = destDropdown +  "</select>";
      // console.log(dropdown);
      document.getElementById("selOrig").innerHTML = origDropdown;
      document.getElementById("selDest").innerHTML = destDropdown;
    }

    $(document).ready(function(){
      possiblePlaces = [''];
      {% for p in places %}
       possiblePlaces.push("{{p}}");
      {% endfor %}
      UpdateDropdownLists();      
    });

    function post() 
    {
      if(!origSelected && !destSelected)
        return;
      var method = "post";
      var path = "/map";

      var form = document.createElement("form");
      form.setAttribute("method", method);
      form.setAttribute("action", path);

      var hiddenField = document.createElement("input");
      hiddenField.setAttribute("type", "hidden");
      hiddenField.setAttribute("name", "locations");
      var strLocations = origem + "\t";
      for (var key in myLocations) {
          strLocations = strLocations + myLocations[key] + "\t";
      }
      strLocations  += dest + "\t"
      hiddenField.setAttribute("value", strLocations);
      form.appendChild(hiddenField);

      document.body.appendChild(form);
      form.submit();
    }

    var origSelected = false;
    var destSelected = false;

    function UpdateWayPointsList (cb)
    {
      if(cb.checked)
      {
        myLocations.push(cb.value);
      }
      else
      {
        var i = myLocations.indexOf(cb.value);
        if(i > -1)
        {
          myLocations.splice(i, 1);
        }
      }

      console.log(myLocations);
    }

    function ShowOtherPlaces ()
    {
        var checkbox = "WayPoints:<br>";
        for (var op in possiblePlaces)
        {
          if ((possiblePlaces[op] != dest) && (possiblePlaces[op] != origem)&&(possiblePlaces[op] != ""))
          {
            checkbox += "<input type='checkbox' onchange='UpdateWayPointsList(this);' value='"+possiblePlaces[op]+"'>"+possiblePlaces[op]+"<br>";
          }
        }
        document.getElementById("WayPointSelection").innerHTML = checkbox;
    }

    function getOrigem(dropdown) {
        var myindex  = dropdown.selectedIndex;
        var SelValue = dropdown.options[myindex].value;
        //document.getElementById("demo").innerHTML = SelValue;
        origem = SelValue;
        origSelected = true;
        if(origSelected && destSelected)
        {
          ShowOtherPlaces();
        }
        UpdateDropdownLists();
        console.log("selected origem")
        return true;
    }

    function getDest(dropdown) {
        var myindex  = dropdown.selectedIndex;
        var SelValue = dropdown.options[myindex].value;
        //document.getElementById("demo").innerHTML = SelValue;
        dest = SelValue;
        destSelected = true;
        if(origSelected && destSelected)
        {
          ShowOtherPlaces();

        }
        UpdateDropdownLists();
        console.log("selected dest")
        return true;
    }
  </script>
</head>


<body>

Origem:
<div id="selOrig">
</div> 

Destino:
<div id="selDest">
</div> 

<div id="WayPointSelection">
</div>

<!-- <button type="button" id="btApend">Apend na lista</button> -->

<button type="button" id="btSubmit" onclick='post();'>Submit</button>

</body>

</html>
{% endautoescape %}
